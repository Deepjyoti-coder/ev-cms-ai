<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Start Charging Session</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase SDK v9 compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
</head>
<body>
  <h1>EV-Charger: Start Charging</h1>
  <form id="chargingForm">
    <label>Vehicle Number: <input type="text" id="vehicleNumber" required></label><br>
    <label>Amount (â‚¹): <input type="number" id="amountPaid" min="1" required></label><br>
    <label>Charger:
      <select id="chargerId" required>
        <option value="charger1">Charger A</option>
        <option value="charger2">Charger B</option>
        <option value="charger3">Charger C</option>
        <option value="charger4">Charger D</option>
      </select>
    </label><br>
    <button type="submit">Start Charging</button>
  </form>
  <p id="successMsg"></p>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDwL6DkusiZ4dw6n2zCkn5fkUKA8jePDxU",
      authDomain: "ev-charger-demo-af910.firebaseapp.com",
      databaseURL: "https://ev-charger-demo-af910-default-rtdb.firebaseio.com",
      projectId: "ev-charger-demo-af910",
      storageBucket: "ev-charger-demo-af910.firebasestorage.app",
      messagingSenderId: "407797049243",
      appId: "1:407797049243:web:3cccc1c34bfc67ddd4a33e",
      measurementId: "G-M3BGNZVTZN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    document.getElementById("chargingForm").onsubmit = function(e) {
      e.preventDefault();
      const vehicleNumber = document.getElementById("vehicleNumber").value.trim();
      const amountPaid = document.getElementById("amountPaid").value;
      const chargerId = document.getElementById("chargerId").value;
      if (!vehicleNumber || !amountPaid || !chargerId) return;

      // Prepare session data
      const sessionData = {
        vehicleNumber,
        amountPaid: Number(amountPaid),
        chargerId,
        startTime: Date.now(),
        active: true
      };
      db.ref("sessions").push(sessionData, function(error) {
        if (!error) {
          document.getElementById("successMsg").innerText = "Charging started!";
          document.getElementById("chargingForm").reset();
          setTimeout(() => { document.getElementById("successMsg").innerText = ""; }, 2000);
        } else {
          document.getElementById("successMsg").innerText = "Error starting session!";
        }
      });
      // Optionally set charger occupied status true
      db.ref("chargers/" + chargerId + "/occupied").set(true);
    };
  </script>
</body>
</html>
